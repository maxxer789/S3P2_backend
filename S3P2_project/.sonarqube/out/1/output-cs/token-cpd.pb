ï
`C:\Users\Max\Documents\GitHub\S3P2_backend\S3P2_project\AccountService\Context\AccountContext.cs
	namespace 	
AccountService
 
. 
Context  
{		 
public

 

class

 
AccountContext

 
:

  !
	DbContext

" +
{ 
public 
AccountContext 
( 
DbContextOptions .
options/ 6
)6 7
:8 9
base: >
(? @
options@ G
)G H
{ 	
} 	
public 
DbSet 
< 
Account 
> 
Accounts &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
DbSet 
< 
AccountPost  
>  !
AccountPosts" .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
} 
} ½,
gC:\Users\Max\Documents\GitHub\S3P2_backend\S3P2_project\AccountService\Controllers\AccountController.cs
	namespace 	
AccountService
 
. 
Controllers $
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
AccountController "
:# $

Controller% /
{ 
private 
readonly 
AccountLogic %
_logic& ,
;, -
private 
readonly 
TokenSettings &
_tokenSettings' 5
;5 6
public 
AccountController  
(  !
AccountLogic! -
logic. 3
,3 4
IOptions5 =
<= >
TokenSettings> K
>K L
tokenSettingsM Z
)Z [
{ 	
_logic 
= 
logic 
; 
_tokenSettings 
= 
tokenSettings *
.* +
Value+ 0
;0 1
} 	
[ 	
HttpGet	 
] 
[ 	
Route	 
( 
$str 
) 
] 
public   
IActionResult   
PostsFromAccount   -
(  - .
int  . 1
Id  2 4
)  4 5
{!! 	
AccountViewModel"" 
account"" $
=""% &
_logic""' -
.""- .
GetAccountFromId"". >
(""> ?
Id""? A
)""A B
;""B C
if## 
(## 
account## 
!=## 
null## 
)## 
{$$ 
return%% 
Ok%% 
(%% 
account%% !
)%%! "
;%%" #
}&& 
return'' 

BadRequest'' 
('' 
$str'' 2
)''2 3
;''3 4
}(( 	
[** 	
HttpPost**	 
]** 
[++ 	
Route++	 
(++ 
$str++ 
)++ 
]++ 
public,, 
IActionResult,, 
Login,, "
(,," #
[,,# $
FromBody,,$ ,
],,, -!
AccountLoginViewModel,,. C
	userLogin,,D M
),,M N
{-- 	
AccountViewModel.. 
Account.. $
=..% &
_logic..' -
...- .
Login... 3
(..3 4
	userLogin..4 =
)..= >
;..> ?
if00 
(00 
Account00 
!=00 
null00 
)00  
{11  
SymmetricSecurityKey22 $
	secretKey22% .
=22/ 0
new221 4 
SymmetricSecurityKey225 I
(22I J
Encoding22J R
.22R S
UTF822S W
.22W X
GetBytes22X `
(22` a
_tokenSettings22a o
.22o p
JWTKey22p v
.22v w
ToString22w 
(	22 €
)
22€ 
)
22 ‚
)
22‚ ƒ
;
22ƒ „
SigningCredentials33 "
credentials33# .
=33/ 0
new331 4
SigningCredentials335 G
(33G H
	secretKey33H Q
,33Q R
SecurityAlgorithms33S e
.33e f

HmacSha25633f p
)33p q
;33q r
JwtSecurityToken55  
token55! &
=55' (
new55) ,
JwtSecurityToken55- =
(55= >
issuer66 
:66 
$str66 4
,664 5
audience77 
:77 
$str77 6
,776 7
claims88 
:88 
new88 
List88  $
<88$ %
Claim88% *
>88* +
(88+ ,
)88, -
,88- .
expires99 
:99 
DateTime99 %
.99% &
Now99& )
.99) *
AddHours99* 2
(992 3
$num993 4
)994 5
,995 6
signingCredentials:: &
:::& '
credentials::( 3
);; 
;;; 
string== 
tokenString== "
===# $
new==% (#
JwtSecurityTokenHandler==) @
(==@ A
)==A B
.==B C

WriteToken==C M
(==M N
token==N S
)==S T
;==T U
return>> 
Ok>> 
(>> 
new>> 
{>> 
tokenString>>  +
}>>, -
)>>- .
;>>. /
}?? 
returnAA 

BadRequestAA 
(AA 
$strAA 2
)AA2 3
;AA3 4
}BB 	
[DD 	
HttpPostDD	 
]DD 
[EE 	
RouteEE	 
(EE 
$strEE 
)EE 
]EE 
publicFF 
IActionResultFF 
RegisterFF %
(FF% &
[FF& '
FromBodyFF' /
]FF/ 0!
AccountLoginViewModelFF1 F
userRegisterFFG S
)FFS T
{GG 	
AccountViewModelHH 

NewAccountHH '
=HH( )
_logicHH* 0
.HH0 1
RegisterHH1 9
(HH9 :
userRegisterHH: F
)HHF G
;HHG H
ifJJ 
(JJ 

NewAccountJJ 
!=JJ 
nullJJ "
)JJ" #
{KK 
returnLL 
CreatedAtActionLL &
(LL& '
$strLL' 1
,LL1 2

NewAccountLL3 =
)LL= >
;LL> ?
}MM 
returnOO 

StatusCodeOO 
(OO 
$numOO !
,OO! "
$strOO# <
)OO< =
;OO= >
}PP 	
}QQ 
}RR ˆ
\C:\Users\Max\Documents\GitHub\S3P2_backend\S3P2_project\AccountService\Logic\AccountLogic.cs
	namespace

 	
AccountService


 
.

 
Logic

 
{ 
public 

class 
AccountLogic 
{ 
private 
readonly 
IAccountRepo %
_repo& +
;+ ,
private 
readonly 
IMapper  
_mapper! (
;( )
public 
AccountLogic 
( 
IAccountRepo (
repo) -
,- .
IMapper/ 6
mapper7 =
)= >
{ 	
_repo 
= 
repo 
; 
_mapper 
= 
mapper 
; 
} 	
public 
AccountViewModel 
GetAccountFromId  0
(0 1
int1 4
Id5 7
)7 8
{ 	
return 
_mapper 
. 
Map 
< 
AccountViewModel /
>/ 0
(0 1
_repo1 6
.6 7
GetAccountFromId7 G
(G H
IdH J
)J K
)K L
;L M
} 	
public 
AccountViewModel 
Login  %
(% &!
AccountLoginViewModel& ;
accountLogin< H
)H I
{ 	
Account 
account 
= 
_repo #
.# $
Login$ )
() *
_mapper* 1
.1 2
Map2 5
<5 6
Account6 =
>= >
(> ?
accountLogin? K
)K L
)L M
;M N
return 
_mapper 
. 
Map 
< 
AccountViewModel /
>/ 0
(0 1
account1 8
)8 9
;9 :
} 	
public!! 
AccountViewModel!! 
Register!!  (
(!!( )!
AccountLoginViewModel!!) >
accountRegister!!? N
)!!N O
{"" 	
if## 
(## 
_repo## 
.## 
AccountExists## #
(### $
_mapper##$ +
.##+ ,
Map##, /
<##/ 0
Account##0 7
>##7 8
(##8 9
accountRegister##9 H
)##H I
)##I J
)##J K
{$$ 
return%% 
null%% 
;%% 
}&& 
accountRegister(( 
.(( 
Password(( $
=((% &
BCrypt((' -
.((- .
Net((. 1
.((1 2
BCrypt((2 8
.((8 9
HashPassword((9 E
(((E F
accountRegister((F U
.((U V
Password((V ^
)((^ _
;((_ `
return** 
_mapper** 
.** 
Map** 
<** 
AccountViewModel** /
>**/ 0
(**0 1
_repo**1 6
.**6 7
Register**7 ?
(**? @
_mapper**@ G
.**G H
Map**H K
<**K L
Account**L S
>**S T
(**T U
accountRegister**U d
)**d e
)**e f
)**f g
;**g h
}++ 	
},, 
}-- )
oC:\Users\Max\Documents\GitHub\S3P2_backend\S3P2_project\AccountService\Migrations\20211112105357_AddAccounts.cs
	namespace 	
AccountService
 
. 

Migrations #
{ 
public 

partial 
class 
AddAccounts $
:% &
	Migration' 0
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder		 
.		 
CreateTable		 (
(		( )
name

 
:

 
$str

  
,

  !
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
Username 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: H
,H I
nullableJ R
:R S
trueT X
)X Y
,Y Z
Password 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: I
,I J
nullableK S
:S T
trueU Y
)Y Z
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 2
,2 3
x4 5
=>6 8
x9 :
.: ;
Id; =
)= >
;> ?
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
	AccountId 
= 
table  %
.% &
Column& ,
<, -
int- 0
>0 1
(1 2
type2 6
:6 7
$str8 =
,= >
nullable? G
:G H
falseI N
)N O
,O P
PostId 
= 
table "
." #
Column# )
<) *
int* -
>- .
(. /
type/ 3
:3 4
$str5 :
,: ;
nullable< D
:D E
falseF K
)K L
} 
, 
constraints   
:   
table   "
=>  # %
{!! 
table"" 
."" 

PrimaryKey"" $
(""$ %
$str""% 5
,""5 6
x""7 8
=>""9 ;
x""< =
.""= >
Id""> @
)""@ A
;""A B
table## 
.## 

ForeignKey## $
(##$ %
name$$ 
:$$ 
$str$$ A
,$$A B
column%% 
:%% 
x%%  !
=>%%" $
x%%% &
.%%& '
	AccountId%%' 0
,%%0 1
principalTable&& &
:&&& '
$str&&( 2
,&&2 3
principalColumn'' '
:''' (
$str'') -
,''- .
onDelete((  
:((  !
ReferentialAction((" 3
.((3 4
Cascade((4 ;
)((; <
;((< =
})) 
))) 
;)) 
migrationBuilder++ 
.++ 
CreateIndex++ (
(++( )
name,, 
:,, 
$str,, 0
,,,0 1
table-- 
:-- 
$str-- $
,--$ %
column.. 
:.. 
$str.. #
)..# $
;..$ %
}// 	
	protected11 
override11 
void11 
Down11  $
(11$ %
MigrationBuilder11% 5
migrationBuilder116 F
)11F G
{22 	
migrationBuilder33 
.33 
	DropTable33 &
(33& '
name44 
:44 
$str44 #
)44# $
;44$ %
migrationBuilder66 
.66 
	DropTable66 &
(66& '
name77 
:77 
$str77  
)77  !
;77! "
}88 	
}99 
}:: þ
qC:\Users\Max\Documents\GitHub\S3P2_backend\S3P2_project\AccountService\Migrations\20211112132340_ChangeAccount.cs
	namespace 	
AccountService
 
. 

Migrations #
{ 
public 

partial 
class 
ChangeAccount &
:' (
	Migration) 2
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder		 
.		 
	DropTable		 &
(		& '
name

 
:

 
$str

 #
)

# $
;

$ %
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
	AccountId 
= 
table  %
.% &
Column& ,
<, -
int- 0
>0 1
(1 2
type2 6
:6 7
$str8 =
,= >
nullable? G
:G H
falseI N
)N O
,O P
PostId 
= 
table "
." #
Column# )
<) *
int* -
>- .
(. /
type/ 3
:3 4
$str5 :
,: ;
nullable< D
:D E
falseF K
)K L
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 5
,5 6
x7 8
=>9 ;
x< =
.= >
Id> @
)@ A
;A B
table 
. 

ForeignKey $
($ %
name 
: 
$str A
,A B
column 
: 
x  !
=>" $
x% &
.& '
	AccountId' 0
,0 1
principalTable &
:& '
$str( 2
,2 3
principalColumn '
:' (
$str) -
,- .
onDelete    
:    !
ReferentialAction  " 3
.  3 4
Cascade  4 ;
)  ; <
;  < =
}!! 
)!! 
;!! 
migrationBuilder## 
.## 
CreateIndex## (
(##( )
name$$ 
:$$ 
$str$$ 0
,$$0 1
table%% 
:%% 
$str%% $
,%%$ %
column&& 
:&& 
$str&& #
)&&# $
;&&$ %
}'' 	
}(( 
})) „
tC:\Users\Max\Documents\GitHub\S3P2_backend\S3P2_project\AccountService\Migrations\20211112133744_AccountWithPosts.cs
	namespace 	
AccountService
 
. 

Migrations #
{ 
public 

partial 
class 
AccountWithPosts )
:* +
	Migration, 5
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder		 
.		 
CreateTable		 (
(		( )
name

 
:

 
$str

 $
,

$ %
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
	AccountId 
= 
table  %
.% &
Column& ,
<, -
int- 0
>0 1
(1 2
type2 6
:6 7
$str8 =
,= >
nullable? G
:G H
falseI N
)N O
,O P
PostId 
= 
table "
." #
Column# )
<) *
int* -
>- .
(. /
type/ 3
:3 4
$str5 :
,: ;
nullable< D
:D E
falseF K
)K L
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 6
,6 7
x8 9
=>: <
x= >
.> ?
Id? A
)A B
;B C
table 
. 

ForeignKey $
($ %
name 
: 
$str B
,B C
column 
: 
x  !
=>" $
x% &
.& '
	AccountId' 0
,0 1
principalTable &
:& '
$str( 2
,2 3
principalColumn '
:' (
$str) -
,- .
onDelete  
:  !
ReferentialAction" 3
.3 4
Cascade4 ;
); <
;< =
} 
) 
; 
migrationBuilder 
. 
CreateIndex (
(( )
name 
: 
$str 1
,1 2
table 
: 
$str %
,% &
column   
:   
$str   #
)  # $
;  $ %
}!! 	
	protected## 
override## 
void## 
Down##  $
(##$ %
MigrationBuilder##% 5
migrationBuilder##6 F
)##F G
{$$ 	
migrationBuilder%% 
.%% 
	DropTable%% &
(%%& '
name&& 
:&& 
$str&& $
)&&$ %
;&&% &
}'' 	
}(( 
})) 	
XC:\Users\Max\Documents\GitHub\S3P2_backend\S3P2_project\AccountService\Models\Account.cs
	namespace 	
AccountService
 
. 
Models 
{		 
public

 

class

 
Account

 
{ 
[ 	
Key	 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[ 	
Column	 
( 
TypeName 
= 
$str )
)) *
]* +
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
virtual 
ICollection "
<" #
AccountPost# .
>. /
Posts0 5
{6 7
get8 ;
;; <
set= @
;@ A
}B C
} 
} 
\C:\Users\Max\Documents\GitHub\S3P2_backend\S3P2_project\AccountService\Models\AccountPost.cs
	namespace 	
AccountService
 
. 
Models 
{ 
public		 

class		 
AccountPost		 
{

 
[ 	
Key	 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
int 
	AccountId 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 
PostId 
{ 
get 
;  
set! $
;$ %
}& '
} 
} È
^C:\Users\Max\Documents\GitHub\S3P2_backend\S3P2_project\AccountService\Models\TokenSettings.cs
	namespace 	
AccountService
 
. 
Models 
{ 
public 

class 
TokenSettings 
{		 
public

 
string

 
JWTKey

 
{

 
get

 "
;

" #
set

$ '
;

' (
}

) *
} 
} ƒ
qC:\Users\Max\Documents\GitHub\S3P2_backend\S3P2_project\AccountService\Models\ViewModels\AccountLoginViewModel.cs
	namespace 	
AccountService
 
. 
Models 
.  

ViewModels  *
{ 
public 

class !
AccountLoginViewModel &
{ 
[ 	
Required	 
] 
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
[		 	
Required			 
]		 
public

 
string

 
Password

 
{

  
get

! $
;

$ %
set

& )
;

) *
}

+ ,
public !
AccountLoginViewModel $
($ %
)% &
{ 	
} 	
} 
} †
lC:\Users\Max\Documents\GitHub\S3P2_backend\S3P2_project\AccountService\Models\ViewModels\AccountViewModel.cs
	namespace 	
AccountService
 
. 
Models 
.  

ViewModels  *
{ 
public		 

class		 
AccountViewModel		 !
{

 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
ICollection 
< 
AccountPost &
>& '
Posts( -
{. /
get0 3
;3 4
set5 8
;8 9
}: ;
} 
} ’
^C:\Users\Max\Documents\GitHub\S3P2_backend\S3P2_project\AccountService\Profiles\UserProfile.cs
	namespace		 	
AccountService		
 
.		 
Profiles		 !
{

 
public 

class 
UserProfile 
: 
Profile &
{ 
public 
UserProfile 
( 
) 
{ 	
	CreateMap 
< 
Account 
, !
AccountLoginViewModel 4
>4 5
(5 6
)6 7
.7 8

ReverseMap8 B
(B C
)C D
;D E
	CreateMap 
< 
Account 
, 
AccountViewModel /
>/ 0
(0 1
)1 2
.2 3

ReverseMap3 =
(= >
)> ?
;? @
} 	
} 
} ­

QC:\Users\Max\Documents\GitHub\S3P2_backend\S3P2_project\AccountService\Program.cs
	namespace

 	
AccountService


 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} «
bC:\Users\Max\Documents\GitHub\S3P2_backend\S3P2_project\AccountService\Repositories\AccountRepo.cs
	namespace		 	
AccountService		
 
.		 
Repositories		 %
{

 
public 

class 
AccountRepo 
: 
IAccountRepo +
{ 
private 
readonly 
AccountContext '
_context( 0
;0 1
public 
AccountRepo 
( 
AccountContext )
context* 1
)1 2
{ 	
_context 
= 
context 
; 
} 	
public 
bool 
AccountExists !
(! "
Account" )
account* 1
)1 2
{ 	
if 
( 
_context 
. 
Accounts  
.  !
SingleOrDefault! 0
(0 1
a1 2
=>3 5
a6 7
.7 8
Username8 @
==A C
accountD K
.K L
UsernameL T
)T U
!=V X
nullY ]
)] ^
{ 
return 
true 
; 
} 
return 
false 
; 
} 	
public 
Account 
GetAccountFromId '
(' (
int( +
Id, .
). /
{ 	
return 
_context 
. 
Accounts $
.$ %
Where% *
(* +
a+ ,
=>- /
a0 1
.1 2
Id2 4
==5 7
Id8 :
): ;
.; <
Include< C
(C D
apD F
=>G I
apJ L
.L M
PostsM R
)R S
.S T
FirstOrDefaultT b
(b c
)c d
;d e
}   	
public"" 
Account"" 
Login"" 
("" 
Account"" $
account""% ,
)"", -
{## 	
Account$$ 
acc$$ 
=$$ 
_context$$ "
.$$" #
Accounts$$# +
.$$+ ,
SingleOrDefault$$, ;
($$; <
a$$< =
=>$$> @
a$$A B
.$$B C
Username$$C K
==$$L N
account$$O V
.$$V W
Username$$W _
)$$_ `
;$$` a
bool&& 
validPassword&& 
=&&  
BCrypt&&! '
.&&' (
Net&&( +
.&&+ ,
BCrypt&&, 2
.&&2 3
Verify&&3 9
(&&9 :
account&&: A
.&&A B
Password&&B J
,&&J K
acc&&L O
.&&O P
Password&&P X
)&&X Y
;&&Y Z
if(( 
((( 
validPassword(( 
)(( 
{)) 
return** 
acc** 
;** 
}++ 
else,, 
{-- 
return.. 
null.. 
;.. 
}// 
}00 	
public22 
Account22 
Register22 
(22  
Account22  '
account22( /
)22/ 0
{33 	
_context44 
.44 
Accounts44 
.44 
Add44 !
(44! "
account44" )
)44) *
;44* +
_context55 
.55 
SaveChanges55  
(55  !
)55! "
;55" #
return66 
account66 
;66 
}77 	
}88 
}99 ’
cC:\Users\Max\Documents\GitHub\S3P2_backend\S3P2_project\AccountService\Repositories\IAccountRepo.cs
	namespace 	
AccountService
 
. 
Repositories %
{ 
public		 

	interface		 
IAccountRepo		 !
{

 
public 
Account 
Login 
( 
Account $
account% ,
), -
;- .
public 
Account 
Register 
(  
Account  '
account( /
)/ 0
;0 1
public 
Account 
GetAccountFromId '
(' (
int( +
Id, .
). /
;/ 0
public 
bool 
AccountExists !
(! "
Account" )
account* 1
)1 2
;2 3
} 
} ˜0
QC:\Users\Max\Documents\GitHub\S3P2_backend\S3P2_project\AccountService\Startup.cs
	namespace 	
AccountService
 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services 
. 
	Configure 
< 
TokenSettings ,
>, -
(- .
Configuration. ;
.; <

GetSection< F
(F G
$strG S
)S T
)T U
;U V
services 
. 
AddControllers #
(# $
)$ %
;% &
services!! 
.!! 
AddAutoMapper!! "
(!!" #
typeof!!# )
(!!) *
Startup!!* 1
)!!1 2
)!!2 3
;!!3 4
services"" 
."" #
AddControllersWithViews"" ,
("", -
)""- .
;"". /
services$$ 
.$$ 
AddCors$$ 
($$ 
options$$ $
=>$$% '
{%% 
options&& 
.&& 
	AddPolicy&& !
(&&! "
$str&&" 3
,&&3 4
builder&&5 <
=>&&= ?
{'' 
builder(( 
.(( 
AllowAnyOrigin(( *
(((* +
)((+ ,
.((, -
AllowAnyMethod((- ;
(((; <
)((< =
.((= >
AllowAnyHeader((> L
(((L M
)((M N
;((N O
})) 
))) 
;)) 
}** 
)** 
;** 
services,, 
.,, 
AddDbContext,, !
<,,! "
AccountContext,," 0
>,,0 1
(,,1 2
options,,2 9
=>,,: <
{-- 
options.. 
... 
UseSqlServer.. $
(..$ %
Configuration..% 2
...2 3
GetConnectionString..3 F
(..F G
$str..G Y
)..Y Z
)..Z [
;..[ \
}// 
)// 
;// 
services11 
.11 
AddAuthentication11 &
(11& '
opt11' *
=>11+ -
{22 
opt33 
.33 %
DefaultAuthenticateScheme33 -
=33. /
JwtBearerDefaults330 A
.33A B 
AuthenticationScheme33B V
;33V W
opt44 
.44 "
DefaultChallengeScheme44 *
=44+ ,
JwtBearerDefaults44- >
.44> ? 
AuthenticationScheme44? S
;44S T
}55 
)55 
.66 
AddJwtBearer66 
(66 
options66 !
=>66" $
{77 
options88 
.88 %
TokenValidationParameters88 1
=882 3
new884 7
	Microsoft888 A
.88A B
IdentityModel88B O
.88O P
Tokens88P V
.88V W%
TokenValidationParameters88W p
{99 
ValidateIssuer:: "
=::# $
true::% )
,::) *
ValidateAudience;; $
=;;% &
true;;' +
,;;+ ,
ValidateLifetime<< $
=<<% &
true<<' +
,<<+ ,$
ValidateIssuerSigningKey== ,
===- .
true==/ 3
,==3 4
ValidIssuer?? 
=??  !
$str??" :
,??: ;
ValidAudience@@ !
=@@" #
$str@@$ <
,@@< =
IssuerSigningKeyAA $
=AA% &
newAA' * 
SymmetricSecurityKeyAA+ ?
(AA? @
EncodingAA@ H
.AAH I
UTF8AAI M
.AAM N
GetBytesAAN V
(AAV W
ConfigurationAAW d
.AAd e

GetSectionAAe o
(AAo p
$strAAp |
)AA| }
[AA} ~
$str	AA~ †
]
AA† ‡
)
AA‡ ˆ
)
AAˆ ‰
,
AA‰ Š
}BB 
;BB 
}CC 
)CC 
;CC 
servicesEE 
.EE 
	AddScopedEE 
<EE 
IAccountRepoEE +
,EE+ ,
AccountRepoEE- 8
>EE8 9
(EE9 :
)EE: ;
;EE; <
servicesFF 
.FF 
	AddScopedFF 
<FF 
AccountLogicFF +
>FF+ ,
(FF, -
)FF- .
;FF. /
}GG 	
publicJJ 
voidJJ 
	ConfigureJJ 
(JJ 
IApplicationBuilderJJ 1
appJJ2 5
,JJ5 6
IWebHostEnvironmentJJ7 J
envJJK N
)JJN O
{KK 	
ifLL 
(LL 
envLL 
.LL 
IsDevelopmentLL !
(LL! "
)LL" #
)LL# $
{MM 
appNN 
.NN %
UseDeveloperExceptionPageNN -
(NN- .
)NN. /
;NN/ 0
}OO 
appQQ 
.QQ 
UseHttpsRedirectionQQ #
(QQ# $
)QQ$ %
;QQ% &
appSS 
.SS 

UseRoutingSS 
(SS 
)SS 
;SS 
appUU 
.UU 
UseCorsUU 
(UU 
$strUU )
)UU) *
;UU* +
appWW 
.WW 
UseAuthorizationWW  
(WW  !
)WW! "
;WW" #
appYY 
.YY 
UseAuthenticationYY !
(YY! "
)YY" #
;YY# $
app[[ 
.[[ 
UseEndpoints[[ 
([[ 
	endpoints[[ &
=>[[' )
{\\ 
	endpoints]] 
.]] 
MapControllers]] (
(]]( )
)]]) *
;]]* +
}^^ 
)^^ 
;^^ 
}__ 	
}`` 
}aa 